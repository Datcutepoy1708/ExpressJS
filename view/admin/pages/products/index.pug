extends ../../layout/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/pagination.pug
include ../../mixins/search.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug

block main
  if(role.permissions.includes("product-view")) 
    //- Success message display
    +alert-success(5000)
    
    //- Page title
    h1 Danh s√°ch s·∫£n ph·∫©m
    
    //- Filter and search section
    .card.mb-3 
      .card-header B·ªô l·ªçc v√† t√¨m ki·∫øm 
      .card-body 
        .row
          .col-6
            +filter-status(filterStatus)
          .col-6 
            +search(keyword)

    //- Product list section
    .card.mb-3 
      .card-header Danh s√°ch 
      .card-body
        .row 
          .col-8
            +form-change-multi(`${prefixAdmin}/products/change-multi?_method=PATCH`)
          .col-4 
            a(
              href=`${prefixAdmin}/products/create`
              class="btn btn-outline-success"
            ) + Th√™m m·ªõi  

    .card.mb-3 
      .card-header S·∫Øp x·∫øp 
      .card-body 
        .row 
          .col-4 
            +sort()   
        table.table.table-hover.table-sm(checkbox-multi)
          thead
            tr
              th
                input(type="checkbox" name="checkall")
              th STT
              th H√¨nh ·∫£nh
              th Ti√™u ƒë·ªÅ
              th Gi√°
              th V·ªã tr√≠
              th Tr·∫°ng th√°i
              th Ng∆∞·ªùi t·∫°o
              th Ng∆∞·ªùi c·∫≠p nh·∫≠t
              th H√†nh ƒë·ªông
          tbody
            each item, index in products
              tr
                td 
                  input(
                    type="checkbox"
                    name="id"
                    value=item.id
                  )
                td #{pagination.limitItems*(pagination.currentPage -1) + (index+1)}
                td
                  img(
                    src=item.thumbnail
                    alt=item.title
                    width="100"
                    height="auto"
                    style="max-width: 100px; height: auto;"
                  )
                td= item.title
                td= item.price + '$'
                td 
                  input(
                    type="number"
                    value=item.position 
                    style="width: 60px;"
                    min="1"
                    name="position"
                  )
                td
                  if item.status === "active"
                    a.badge.bg-success(
                      href="javascript:;"
                      data-status=item.status
                      data-id=item.id
                      button-change-status
                    ) Ho·∫°t ƒë·ªông
                  else 
                    a.badge.bg-danger(
                      href="javascript:;"
                      data-status=item.status
                      data-id=item.id
                      button-change-status
                    ) D·ª´ng ho·∫°t ƒë·ªông
                
                //- üî• NG∆Ø·ªúI T·∫†O - gi·ªØ nguy√™n
                td 
                  p #{item.accountFullName || "Kh√¥ng r√µ"}
                  if(item.createdBy && item.createdBy.createdAt)
                    p 
                      +formatDateTime(item.createdBy.createdAt)
                
                //- üî• NG∆Ø·ªúI C·∫¨P NH·∫¨T - ƒê√É FIX
                td 
                  if(item.lastEditBy)
                    div 
                      div.fw-bold.text-primary #{item.lastEditBy} 
                      small.text-muted.d-block 
                        i.fas.fa-edit.me-1 
                        +formatDateTime(item.lastEditedAt)
                      if(item.editedBy && item.editedBy > 0)
                        small.badge.bg-info.text-white.mt-1 
                          i.fas.fa-history.me-1 
                          |  #{item.editedBy} l·∫ßn ch·ªânh s·ª≠a 
                  else 
                    div.text-muted.small 
                      i.fas.fa-minus-circle.me-1 
                      | Ch∆∞a ch·ªânh s·ª≠a
                td
                  a(
                    href=`${prefixAdmin}/products/detail/${item.id}`
                    class="btn btn-secondary btn-sm"
                  ) Chi ti·∫øt
                  if(role.permissions.includes("product-edit"))
                    a(
                      href=`${prefixAdmin}/products/edit/${item.id}`
                      class="btn btn-warning btn-sm"
                    ) S·ª≠a
                  if(role.permissions.includes("product-delete"))
                    button.btn.btn-danger.btn-sm.ml-1(
                      type="button"
                      data-id=item.id
                      button-delete
                    ) X√≥a

        //- Pagination
        +pagination(pagination)

        //- Hidden forms for AJAX operations
        form#form-change-status(
          action=""
          method="POST"
          data-path=`${prefixAdmin}/products/change-status`
        )
        
        form#form-delete-item(
          action=""
          method="POST"
          data-path=`${prefixAdmin}/products/delete`
        )

    //- JavaScript
    script(src="/admin/js/product.js")