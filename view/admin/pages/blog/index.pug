extends ../../layout/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/pagination.pug
include ../../mixins/search.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug

block main 
 if(role.permissions.includes("blog-view"))
  +alert-success(5000)

  h1 Danh sách sản phẩm 

  .card.mb-3 
    .card-header Bộ lọc và tìm kiếm 
    .card-body 
      .row 
        .col-6 
          +filter-status(filterStatus)
        .col-6 
          +search(keyword)
        
  .card.mb-3 
    .card-header Danh sách 
    .card-body 
      .row 
        .col-8 
          +form-change-multi(`${prefixAdmin}/blog/change-multi?_method=PATCH`)
        .col-4 
          a(
            href=`${prefixAdmin}/blog/create`
            class="btn btn-outline-success"
          ) + Thêm mới
    
  .card.mb-3 
    .card-header Sắp xếp 
    .card-body 
      .row 
        .col-4 
          +sort()
      table.table.table-hover.table-sm(checkbox-multi)
       thead 
         tr 
           th 
             input(type="checkbox" name="checkall")
           th STT 
           th Hình ảnh 
           th Tiêu đề
           th Vị trí 
           th Trạng thái
           th Người tạo
           td Người cập nhật 
           th Hàng động
       tbody 
         each item,index in blogs 
           tr 
             td 
              input(
                type="checkbox"
                name="id"
                value=item.id
              )
             td #{pagination.limitItems*(pagination.currentPage-1)+(index+1)}
             td 
               img(
                src=item.thumbnail 
                alt=item.title 
                width="100"
                height="auto"
                style="max-width:100px; height:auto;"
               )
             td #{item.title} 
             td 
               input(
                type="number"
                value=item.position 
                style="width:60px;"
                min="1"
                name="position"
               )
             td 
               if item.status==="active"
                 a.badge.bg-success(
                    href="javascript:;"
                    data-status=item.status 
                    data-id=item.id 
                    button-change-status
                 ) Hoạt động
               else 
                 a.badge.bg-danger(
                    href="javascript:;"
                    data-status=item.status 
                    data-id=item.id 
                    button-change-status
                 ) Dừng hoạt động
             td 
               p #{item.accountFullName|| "Không rõ"}
               if(item.createdBy && item.createdBy.createdAt)
                 p 
                   +formatDateTime(item.createdBy.createdAt)
             td 
               if(item.lastEditBy)
                 div 
                   div.fw-bold.text-primary #{item.lastEditBy} 
                   small.text-muted.d-block 
                     i.fas.fa-edit.me-1 
                     +formatDateTime(item.lastEditedAt)
                   if(item.editedBy && item.editedBy > 0)
                     small.badge.bg-info.text-white.mt-1 
                       i.fas.fa-history.me-1 
                       |  #{item.editedBy} lần chỉnh sửa 
               else 
                div.text-muted.small 
                  i.fas.fa-minus-circle.me-1 
                  | Chưa chỉnh sửa
             td
                if(role.permissions.includes("blog-view"))
                 a(
                    href=`${prefixAdmin}/blog/detail/${item.id}`
                    class="btn btn-secondary btn-sm"
                  ) Chi tiết
                if(role.permissions.includes("blog-edit"))
                    a(
                      href=`${prefixAdmin}/blog/edit/${item.id}`
                      class="btn btn-warning btn-sm"
                    ) Sửa
                if(role.permissions.includes("blog-delete"))
                    button.btn.btn-danger.btn-sm.ml-1(
                      type="button"
                      data-id=item.id
                      button-delete
                    ) Xóa
      +pagination(pagination)

      form#form-change-status(
        action=""
        method="POST"
        data-path=`${prefixAdmin}/blog/change-status`
      )
      form#form-delete-item(
        action=""
        method="POST"
        data-path=`${prefixAdmin}/blog/delete`
      )
  script(src="/admin/js/blog.js")